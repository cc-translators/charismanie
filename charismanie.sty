\ProvidesPackage{charismanie}

\usepackage[english,french]{babel} %language selection
\selectlanguage{french}

\usepackage{amsmath}
\usepackage[mathletters]{ucs}
%\usepackage[utf8x]{inputenc}

% nice serif font
%\usepackage[T1]{fontenc}
%\usepackage{lmodern}
%\usepackage{libertine}

% Use fourier ornaments
\usepackage{fourier-orns}

% bible references
\usepackage{bibleref-french-colombe}

% header and footer
\usepackage[automark]{scrpage2}

% Use ifpdf
\usepackage{ifpdf}

% Make indexes
\newcommand{\indextitle}{Index des r\'ef\'erences bibliques}
\usepackage{imakeidx}
\makeindex[title=\indextitle,intoc,options=-s bibleref.ist,columns=2]
% Only reference Bible chapters in index
%\usepackage[verses]{bibleref-xidx}

% setting lettrines
\usepackage{type1cm} % scalable fonts
\usepackage{lettrine}
\usepackage{xcolor}
% set paragraphs

\hfuzz = .6pt % avoid black boxes

\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setcounter{secnumdepth}{0}

% set split mode for debug
\makeatletter
\newcommand{\@config@split}{0}
\makeatother

% Set fonts
\usepackage{fontspec}
\usepackage{xunicode}
\setmainfont[Mapping=tex-text]{Linux Libertine O}

\newfontfamily\normalfont[Mapping=tex-text]{Linux Libertine O}
\newfontfamily\chapfont{Garamond LT}
\newfontfamily\chapheadfont[Scale=1.2,LetterSpace=5,WordSpace=5]{Latino Elongated LET}
\newfontfamily\chaptocfont[Scale=1.4,LetterSpace=10,WordSpace=10]{Latino Elongated LET}
\newfontfamily\secfont{Garamond LT}
\newfontfamily\headerfont[LetterSpace=12,WordSpace=2]{Linux Libertine O}

% Make nice chapter headings
\usepackage{titlesec}
\newcommand{\chapstyle}{\chapfont\raggedleft\Large\itshape}
\newcommand{\chapheadstyle}{\chapheadfont\Huge}
\titleformat{\chapter}[display]
  {\chapstyle}
  {\chaptertitlename\ \thechapter}{10pt}
  {\chapheadstyle}
\titlespacing*{\chapter}
  {0pt}{0pt}{0pt}

\newcommand{\secstyle}{\secfont\large\itshape}
\titleformat{\section}%
  {\secstyle} % format
  {} % label
  {10pt} % sep
  {} % before
  [\normalfont] % after
\titlespacing*{\section}
  {0pt}{0pt}{0pt}

% Get title
\makeatletter
\let\titlehead\@title
\makeatother

% setting table of contents
%\ifpdf
\usepackage{tocloft}

% No scshape...
% horrible hack
\newcommand{\mychaptertitlename}{{\normalsize{C}}{\footnotesize{\,HAPITRE}}\;\normalsize}

\renewcommand\cfttoctitlefont{\vspace{-6em}\hfill\chapheadfont\Huge\scshape}
\renewcommand\cftaftertoctitle{\hfill\vspace{-2.5em}}
\renewcommand\cftchapfont{\chaptocfont }
\renewcommand\cftchappresnum{\mychaptertitlename\ }
\renewcommand\cftchapaftersnumb{\newline\vspace{-8pt}\normalfont}
\renewcommand\cftchapleader{\cftdotfill{1}}
\renewcommand\cftchappagefont{\normalfont}
%\fi

% Define \chaphead to be used in section headings
\let\oldchapter\chapter
\newcommand\temphead{}
\newcommand\chaphead{}
\renewcommand\chapter[2][\temphead]{%
    \cleardoublepage
    \renewcommand\temphead{#2}%
    \ifx #1 \@empty
       \renewcommand\chaphead{#2}%
    \else
       \renewcommand\chaphead{#1}%
    \fi
    \oldchapter[#1]{#2}}


% Set headers and footers
%\automark[chapter]{section}
%\setheadsepline{.4pt}
\cfoot[\rule{6mm}{0.8pt}\\\pagemark]{\rule{6mm}{0.8pt}\\\pagemark}
\ofoot[]{}
\lehead[]{}
%\ifpdf
  \cehead[]{\headerfont\textsc{\titlehead}}
  \cohead[]{\headerfont\textsc{\chaphead}}
%\else
%  \cehead[]{}
%  \cohead[]{}
%\fi
\ohead[]{}

\renewcommand*{\chapterpagestyle}{scrplain}

% Set index
\newcommand{\chindex}{%
  % Restore normal chapters
  \let\chapter\oldchapter
  % Appendix
  %\ifpdf
    \cohead[]{\headerfont\textsc{\indextitle}}
  %\fi
  \renewcommand{\chapstyle}{\centering}
  \renewcommand{\chapheadstyle}{\chapheadfont\Huge}
  \titlespacing*{\chapter}
    {0pt}{1em}{5em}
  \renewcommand*{\BRbooktitlestyle}[1]{\textbf{\emph{##1}}}
  \def\imki@firstpagestyle{empty}
  \printindex
}

% Creative Commons
\usepackage{ccicons}


%%%%%%%%%%%%%%%%%
% Useful macros
%%%%%%%%%%%%%%%%%

% NdT macro
\newcommand{\NdT}[1]{\footnote{NdT~: #1}}

% Seigneur macro
\newcommand{\Seigneur}{\textsc{Seigneur}}

% Rule for titles
\newcommand{\HRule}{\rule{\linewidth}{0.2mm}}

% lettrines
\renewcommand{\LettrineFontHook}{\color[gray]{0.7}}
\newcommand{\chlettrine}[3][]{
%  \ifpdf
    \lettrine[lines=3,lhang=0.33,loversize=0.25,#1]{#2}{#3}
%  \else
%    #2#3
%  \fi
}

\newcommand{\lettrineA}[2][]{%
  \chlettrine[slope=5pt,findent=-0.5em,#1]{A}{#2}
}

\newcommand{\lettrineJap}[2][]{%
  % Apostrophe in lettrine
  %\chlettrine[lraise=0.1,loversize=0.15,nindent=-0.7em,#1]{J'}{#2}
  % Apostrophe in small caps
  \chlettrine[lraise=0.20,nindent=0em,#1]{J}{'#2}
}

\newcommand{\lettrineLap}[2][]{%
  % Apostrophe in lettrine
  %\chlettrine[lraise=0,loversize=0.15,#1]{L\kern-12pt{'}}{#2}
  % Apostrophe in small caps
  %\chlettrine[lraise=0,loversize=0.08,findent=-0.9em,nindent=1em,#1]{L}{'#2}
  % Apostrophe in small caps with slope
  \chlettrine[lraise=0,loversize=0.08,findent=-0.9em,slope=0.5em,#1]{L}{'#2}
}

\newcommand{\lettrineP}[2][]{%
  \chlettrine[findent=0.1em,nindent=0.1em,#1]{P}{#2}
}

\newcommand{\lettrineQ}[2][]{%
  \chlettrine[lraise=0.30,loversize=0.15,#1]{Q}{#2}
}

\newcommand{\lettrineS}[2][]{%
  \chlettrine[#1]{S}{#2}
}

% cadratin
\newcommand*{\ocadr}{\mbox{---}\nobreak\,\nobreak}
\newcommand*{\fcadr}{\unskip\nobreak\,\nobreak{}---}

% demi-cadratin
\newcommand*{\odcadr}{\mbox{--}\nobreak\thinspace\nobreak}
\newcommand*{\fdcadr}{\unskip\nobreak\thinspace\nobreak{}--}


