language: c
install:
  - sudo apt-add-repository -y ppa:texlive-backports
  - sudo apt-get update
  - sudo apt-get install texlive-latex-extra texlive-publishers texlive-humanities texlive-lang-french texlive-xetex
  - sudo apt-get install texlive-fonts-recommended texlive-fonts-extra
  # epub
  - sudo apt-get install tex4ht calibre
  # EB Garamond
  - wget https://bitbucket.org/georgd/eb-garamond/downloads/EBGaramond-0.016.zip
  - unzip EBGaramond-0.016.zip
  - cp EBGaramond-0.016/otf/* fonts/
matrix:
  include:
    - env: BUILD=pdf DEPLOY=true
      script: make charismanie.pdf LATEX_INTERACTION="nonstopmode -halt-on-error"
    - env: BUILD=epub
      script: make charismanie.epub
  allow_failures:
    - env: BUILD=epub
deploy:
  provider: releases
  api_key:
    secure: FWC4Dt115sXLgyN/wEFdNOASIoCGZCxIzx/O1ESIZ4QCE2wxUUn1goOpLNMSFJ8MPlWgwPZLfGCRHG/LvvnQ/2n1rOAfG/ri7L9Qw2JCVBi2KhJ3K6QDGla0KsAuAaKQZv2TKRcGSx/EO3UcL+tn/DxcIa9GZ8n4lbuUuJFWcOA=
  file: charismanie.pdf
  skip_cleanup: true
  on:
    tags: true
    env: DEPLOY=true
